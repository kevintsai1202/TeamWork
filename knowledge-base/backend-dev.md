## 🔧 T19 上下文治理收斂流程（Spring Boot + Redis）
**日期：** 2026-02-23
**情境：** 在既有任務系統中完成 T19-1~T19-4，並維持「每子任務必測試通過」的閘控節奏。
**最佳實踐：**
- 先完成讀取面（用量統計、完整上下文檢視），再補寫入面（自動壓縮、手動刪除），降低風險與回歸範圍。
- 自動壓縮採用「閾值觸發 + 保留最近 N 筆 + 系統摘要替代」，並獨立維護 `compressionCount`，避免只靠推估值。
- 手動刪除 API 一次設計完整模式（`SINGLE_MESSAGE`、`RANGE`、`SUMMARY`、`ALL_HISTORY`），同時落地審計表，避免後補稽核造成資料不一致。
- 測試策略採「先針對變更檔案跑小範圍，再跑全量」；遇到 Mockito 嚴格模式衝突時，以測試類別層級調整 strictness，避免污染生產碼。
- 文件同步用「RoadMap + todolist + api」三點對齊：狀態、Gate、已完成子任務與版本日期需同日更新，避免規格/實作漂移。
